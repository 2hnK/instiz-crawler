# ğŸ•¸ï¸ Instiz Crawler

**(ì›”ë³„ í¬ë¡¤ë§ Â· ë™ì  ìƒ˜í”Œë§ / ë¹ˆ í˜ì´ì§€ ë°±íŠ¸ë™ ë³´ì • ì§€ì›)**

---

## ğŸ“˜ ê°œìš”

* ì¸ìŠ¤í‹°ì¦ˆ ì»¤ë®¤ë‹ˆí‹°(ì˜ˆ: ì¼ìƒ ê²Œì‹œíŒ)ë¥¼ **ì›” ë‹¨ìœ„**ë¡œ í¬ë¡¤ë§í•©ë‹ˆë‹¤.
* ì›”ë³„ í˜ì´ì§€ ìˆ˜ê°€ ë‹¬ë¼ë„ ê· ë“±í•œ ì–‘ì˜ ë°ì´í„°ë¥¼ í™•ë³´í•˜ê¸° ìœ„í•´ **në°°ìˆ˜(page 1, 11, 21 â€¦)** ë°©ì‹ì˜ ìƒ˜í”Œë§ì„ ì§€ì›í•©ë‹ˆë‹¤.
* ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì‚¬ì´íŠ¸ íŠ¹ì„±ìƒ **ë¸Œë¼ìš°ì € ì¿ í‚¤ ë¬¸ìì—´** ë˜ëŠ” **JSON ì¿ í‚¤ íŒŒì¼**ì„ ì´ìš©í•´ ì„¸ì…˜ì„ ìœ ì§€í•©ë‹ˆë‹¤.
* ì„¸ì…˜ì´ ë§Œë£Œë˜ë©´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ì¢…ë£Œ ë˜ëŠ” ì¬ì‹œë„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
* **ì œëª©, ë³¸ë¬¸, ëŒ“ê¸€**ì„ ìˆ˜ì§‘í•˜ë©° ê²°ê³¼ëŠ” **CSV(ê¸°ë³¸)** ë˜ëŠ” **JSONL(ì˜µì…˜)** í˜•ì‹ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

---

## âš–ï¸ ë²•ì Â·ì •ì±…ì  ì•ˆë‚´

> âš ï¸ ë³¸ ë„êµ¬ëŠ” í•©ë²•ì ì´ê³  í—ˆìš©ëœ ë²”ìœ„ ë‚´ì—ì„œì˜ ë°ì´í„° ìˆ˜ì§‘ì„ ì „ì œë¡œ í•©ë‹ˆë‹¤.

* `robots.txt`, ì»¤ë®¤ë‹ˆí‹° ì´ìš©ì•½ê´€, ê´€ë ¨ ë²•ë ¹ì„ ë°˜ë“œì‹œ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.
* **ë¡œê·¸ì¸ ìê²© ì¦ëª…(ì¿ í‚¤ í¬í•¨)**ì€ ë³´ì•ˆìƒ ë¯¼ê°í•œ ì •ë³´ì´ë¯€ë¡œ **ì™¸ë¶€ì— ê³µê°œí•˜ê±°ë‚˜ ê³µìœ í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.**
* ë³¸ ë„êµ¬ëŠ” instiz.netì˜ `robots.txt` ì •ì±…ì„ ì¤€ìˆ˜í•˜ëŠ” ë²”ìœ„ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## âš™ï¸ ì„¤ì¹˜

```bash
# Python 3.9 ì´ìƒ ê¶Œì¥
python -m venv .venv
source .venv/bin/activate   # (Windows: .venv\Scripts\activate)
pip install -r requirements.txt
```

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1ï¸âƒ£ ì¿ í‚¤ ì¤€ë¹„ (í•„ìˆ˜)

* ë¡œê·¸ì¸ëœ ë¸Œë¼ìš°ì €ì˜ **ê°œë°œìë„êµ¬ â†’ Network íƒ­**ì—ì„œ ìš”ì²­ì˜ `Cookie` í—¤ë” ì „ì²´ë¥¼ ë³µì‚¬í•˜ê±°ë‚˜,
* `cookies.json` íŒŒì¼ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.
  (ë„ë©”ì¸ì€ ë°˜ë“œì‹œ `instiz.net` ê¸°ì¤€)

---

### 2ï¸âƒ£ ì‹¤í–‰ ì˜ˆì‹œ

**ì¿ í‚¤ ë¬¸ìì—´ ì§ì ‘ ì „ë‹¬**

```bash
python -m instiz_crawler.cli \
  --cookie-string "name=value; name2=value2" \
  --start 2024-01-01 --end 2024-12-31 --month-step 1 \
  --target-posts-per-month 5000 --posts-per-page 20 \
  --output-dir data --output-format csv
```

**JSON ì¿ í‚¤ íŒŒì¼ ì‚¬ìš©**

```bash
python -m instiz_crawler.cli \
  --cookies-json cookies.json \
  --start 2024-01-01 --end 2024-12-31 --month-step 1 \
  --target-posts-per-month 5000 --posts-per-page 20 \
  --output-dir data --output-format csv
```

---

## âš™ï¸ ì£¼ìš” ë§¤ê°œë³€ìˆ˜ (CLI)

| ì˜µì…˜                                  | ì„¤ëª…                                  | ê¸°ë³¸ê°’                           |
| ----------------------------------- | ----------------------------------- | ----------------------------- |
| `--start`, `--end`                  | í¬ë¡¤ë§ ê¸°ê°„ (í¬í•¨)                         | ì˜ˆ: `2024-01-01`, `2024-12-31` |
| `--month-step`                      | ì›” ë‹¨ìœ„ ì¦ê°€ ê°„ê²©                          | `1`                           |
| `--board-path`                      | ê²Œì‹œíŒ ê²½ë¡œ                              | `name`                        |
| `--category`                        | ì¹´í…Œê³ ë¦¬ ë²ˆí˜¸                             | `1`                           |
| `--stype`                           | ê²€ìƒ‰ íƒ€ì…                               | `9`                           |
| `--k`                               | í‚¤ì›Œë“œ                                 | `ê¸°ê°„íƒìƒ‰`                        |
| `--target-posts-per-month`          | ì›”ë³„ ëª©í‘œ ê²Œì‹œë¬¼ ìˆ˜                         | -                             |
| `--posts-per-page`                  | í˜ì´ì§€ë‹¹ ê²Œì‹œë¬¼ ìˆ˜(ì¶”ì •ì¹˜)                     | `20`                          |
| `--page-start`                      | í˜ì´ì§€ ì‹œì‘ ë²ˆí˜¸                           | `1`                           |
| `--fixed-step`                      | ê³ ì • n-ë°°ìˆ˜ ê°„ê²©                          | -                             |
| `--output-dir`                      | ê²°ê³¼ ì¶œë ¥ ë””ë ‰í„°ë¦¬                          | `data`                        |
| `--output-format`                   | ì¶œë ¥ í˜•ì‹ (`csv`, `jsonl`)              | `csv`                         |
| `--cookies-json`, `--cookie-string` | ë¡œê·¸ì¸ ì„¸ì…˜ ì¿ í‚¤ ì œê³µ                        | -                             |
| `--cookie-mode`                     | ì¿ í‚¤ í•´ì„ ë°©ì‹ (`auto`, `string`, `json`) | `auto`                        |
| `--http-proxy`, `--https-proxy`     | í”„ë¡ì‹œ ì„¤ì •                              | -                             |
| `--min-delay`, `--max-delay`        | ìš”ì²­ ê°„ ëœë¤ ëŒ€ê¸°(ì´ˆ)                       | -                             |
| `--max-retries`                     | ì‹¤íŒ¨ ì¬ì‹œë„ íšŸìˆ˜                           | -                             |
| `--timeout`                         | ìš”ì²­ íƒ€ì„ì•„ì›ƒ(ì´ˆ)                          | -                             |
| `--selectors`                       | ì„ íƒì ì„¤ì • JSON íŒŒì¼ ê²½ë¡œ                   | -                             |
| `--skip-existing`                   | ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì›”ë³„ íŒŒì¼ ê±´ë„ˆëœ€                   | -                             |
| `--dry-run`                         | ì‹¤ì œ ìˆ˜ì§‘ ì—†ì´ ê³„íšë§Œ ì¶œë ¥([PLAN] ë¡œê·¸ í‘œì‹œ)     | -                             |
| `--empty-page-backtrack-limit`      | ë¹ˆ ëª©ë¡ í˜ì´ì§€ ì‹œ ì—­ë°©í–¥ ëŒ€ì²´ íƒìƒ‰ ì‹œë„ íšŸìˆ˜         | `3`                           |
| `--empty-page-backtrack-step`       | ì—­íƒìƒ‰ ê°„ê²©(í˜ì´ì§€). ì˜ˆ: 10ì´ë©´ p-10, p-20â€¦      | `10`                          |

---

## ğŸ” ë™ì‘ ë°©ì‹

### 1ï¸âƒ£ ì›”ë³„ ê¸°ê°„ ìƒì„±

* `starttime=YYYY/MM/DD+00:00`
* `endtime=YYYY/MM/DD+00:00`
  â†’ ì˜ˆ: 2024-01 â†’ `start=2024/01/01+00:00`, `end=2024/02/01+00:00`

### 2ï¸âƒ£ í˜ì´ì§€ ìˆ˜ ì§‘ê³„ ë° ë™ì  ìƒ˜í”Œë§

* ì „ì²´ í˜ì´ì§€ ìˆ˜ë¥¼ ì¶”ì •í•œ ë’¤,
  `pages_needed = ceil(n / p)`
  `step = max(1, round(total_pages / pages_needed))`
* ë°©ë¬¸ ìˆœì„œ: `1, 1+step, 1+2*step â€¦`
* ë¹ˆ ëª©ë¡ í˜ì´ì§€(ë§ë‹¨ ì‚­ì œ ë“±)ì¼ ê²½ìš° `p-10 â†’ p-20 â†’ p-30` ìˆœìœ¼ë¡œ ëŒ€ì²´ í˜ì´ì§€ë¥¼ ìë™ ì‹œë„í•©ë‹ˆë‹¤(ì¡°ì ˆ ê°€ëŠ¥).

### 3ï¸âƒ£ ê²Œì‹œê¸€Â·ëŒ“ê¸€ íŒŒì‹±

* ëª©ë¡: HOT/ë°°ë„ˆ/ê´‘ê³ /ì¤‘ê°„ ì„¹ì…˜ ì œì™¸ í›„ ìœ íš¨ ê²Œì‹œë¬¼ë§Œ ì¶”ì¶œ(`selectors.json` ë°˜ì˜)
* ë³¸ë¬¸: `post_body_strict` â†’ `post_body` ìˆœìœ¼ë¡œ ì¶”ì¶œ, ë¶ˆí•„ìš” ìš”ì†Œ(`post_body_exclude`) ì œê±°
* ëŒ“ê¸€: ì„ íƒì ê¸°ë°˜ìœ¼ë¡œ ê°€ëŠ¥í•œ ë²”ìœ„ ë‚´ ì¶”ì¶œ(ë¹„ë™ê¸°/í˜ì´ì§• ëŒ“ê¸€ì€ ì¼ë¶€ë§Œ ìˆ˜ì§‘ë  ìˆ˜ ìˆìŒ)

### 4ï¸âƒ£ ì„¸ì…˜ ë§Œë£Œ ê°ì§€

* ì‘ë‹µ ë‚´ ë¡œê·¸ì¸ í˜ì´ì§€ ì‹ í˜¸ë¥¼ ê°ì§€í•˜ë©´ `SessionExpired` ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
* ì¿ í‚¤ë¥¼ ê°±ì‹ í•œ ë’¤ ì¬ì‹¤í–‰í•˜ë©´ ì•ˆì „í•˜ê²Œ ì´ì–´ì§‘ë‹ˆë‹¤.

---

## ğŸ’¾ ì¶œë ¥ í˜•ì‹

### ê²Œì‹œê¸€ CSV (`data/instiz_YYYY-MM.csv`)

| ì»¬ëŸ¼               | ì„¤ëª…        |
| ---------------- | --------- |
| `id`             | ê²Œì‹œê¸€ ID    |
| `url`            | ê²Œì‹œê¸€ URL   |
| `title`          | ì œëª©        |
| `body`           | ë³¸ë¬¸ í…ìŠ¤íŠ¸    |
| `created_at`     | ì‘ì„± ì‹œê°     |
| `likes`          | ì¢‹ì•„ìš” ìˆ˜     |
| `comments_count` | ëŒ“ê¸€ ìˆ˜      |

---

## ğŸ§© ì„ íƒì ì„¤ì •

`config.example.json` ë˜ëŠ” `selectors.json` ì˜ˆì‹œë¥¼ ì°¸ê³ í•´ ì‹¤ì œ DOM êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •í•©ë‹ˆë‹¤.

| í‚¤                       | ì„¤ëª…                                     |
| ----------------------- | -------------------------------------- |
| `post_body_strict`      | ë³¸ë¬¸ í…ìŠ¤íŠ¸ ë¸”ë¡ ì„ íƒì (ì˜ˆ: `#memo_content_1 p`) |
| `post_body`             | ë³¸ë¬¸ ì»¨í…Œì´ë„ˆ ì„ íƒì                            |
| `post_body_exclude`     | ë³¸ë¬¸ì—ì„œ ì œê±°í•  ì˜ì—­                            |
| `post_images`           | ë³¸ë¬¸ ì´ë¯¸ì§€ ì„ íƒì                             |
| `comments.item`         | ëŒ“ê¸€ ë¸”ë¡ ì„ íƒì                              |
| `comment_pager.anchors` | ajax ëŒ“ê¸€ í˜ì´ì§•                            |
| `list_item_link`        | ëª©ë¡ ë‚´ ê²Œì‹œê¸€ ë§í¬                            |
| `list_scope`            | ìœ íš¨ ëª©ë¡ ë²”ìœ„(ì˜ˆ: `#mboard list`)                 |
| `exclude_scopes`        | HOT/ë°°ë„ˆ/ê´‘ê³ /ì¤‘ê°„ ì„¹ì…˜ ë“± ì œì™¸ ë²”ìœ„             |
| `list_comment_count`    | ëª©ë¡ì—ì„œ ëŒ“ê¸€ ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë…¸ë“œ ì„ íƒì             |

---

## âš ï¸ í•œê³„ ë° ì£¼ì˜ì‚¬í•­

* DOM êµ¬ì¡°ë‚˜ í˜ì´ì§€ë„¤ì´ì…˜ í˜•ì‹ì´ ë°”ë€” ê²½ìš°, ì„ íƒì ë˜ëŠ” ì •ê·œì‹ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
* ì¼ë¶€ ëŒ“ê¸€ì€ ë¹„ë™ê¸°ë¡œ ë¡œë“œë˜ë¯€ë¡œ ì „ë¶€ ìˆ˜ì§‘ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìš”ì²­ ë¹ˆë„ê°€ ê³¼ë„í•˜ë©´ ì„œë²„ ë¶€í•˜ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ `min-delay`, `max-delay`ë¥¼ ì¶©ë¶„íˆ ì„¤ì •í•˜ì„¸ìš”.

---

## ğŸ“‹ ì‹¤í–‰ ì „ í™•ì¸ì‚¬í•­

* ì¿ í‚¤ ì œê³µ ë°©ì‹ (`--cookie-string` ë˜ëŠ” `--cookies-json`)
* ì›”ë³„ ëª©í‘œ ê²Œì‹œë¬¼ ìˆ˜ ë° í˜ì´ì§€ë‹¹ ê²Œì‹œë¬¼ ìˆ˜ ì¶”ì •
* ëŒ€ìƒ ê²Œì‹œíŒ ë° ì¹´í…Œê³ ë¦¬ ì„¤ì •
* ì¶œë ¥ í˜•ì‹ (`csv`, `jsonl`, `parquet` ë“±)
* í”„ë¡ì‹œ ì‚¬ìš© ì—¬ë¶€

---

## ğŸ§ª ê°œë°œ ë° í…ŒìŠ¤íŠ¸

```bash
pip install -r requirements-dev.txt
pytest -q
```

> í…ŒìŠ¤íŠ¸ëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ëª¨í‚¹(mocking)í•˜ì—¬ ì•ˆì „í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤.

---

## ğŸ’¡ ìœ ìš©í•œ ì˜µì…˜

| ì˜µì…˜                                            | ì„¤ëª…                  |
| --------------------------------------------- | ------------------- |
| `--preset sampling`                           | ì‚¬ìš©ì ì§€ì • í”„ë¦¬ì…‹ ì‚¬ìš©       |
| `--sequential-pages`                          | ìˆœì°¨ ë°©ë¬¸ (ê¸°ë³¸ê°’)         |
| `--dynamic-sampling`                          | ë™ì  ê°„ê²© ë°©ë¬¸            |
| `--skip-list-top-n N`                         | ê° í˜ì´ì§€ ìƒë‹¨ Nê°œ ê²Œì‹œê¸€ ê±´ë„ˆëœ€ |
| `--enforce-search-filter`                     | ê¸°ê°„íƒìƒ‰ í•„í„° ìœ ì§€ëœ ë§í¬ë§Œ ìˆ˜ì§‘  |
| `--strict-url-encoding`                       | URL ì¸ì½”ë”©ì„ ì—„ê²©íˆ ìˆ˜í–‰     |
| `--end-2359`                                  | ì¢…ë£Œ ì‹œê°„ì„ 23:59ë¡œ ì„¤ì •    |
| `--comments-count-from-parsed`                | ì‹¤ì œ íŒŒì‹±ëœ ëŒ“ê¸€ ìˆ˜ë¡œ ê¸°ë¡     |
| `--comment-created-fallback {blank,now,post}` | ëŒ“ê¸€ ì‹œê° ëˆ„ë½ ì‹œ ëŒ€ì²´ê°’ ì§€ì •   |

---

## ğŸ§­ ì‹¤í–‰ íŒ

* ì‹¤í–‰ ì „ `--dry-run --verbose`ë¡œ [PLAN] ë¡œê·¸(ì‹œê°„ëŒ€ë³„/ì›”ë³„ `total_pages`, `pick`, `pages_preview`)ë¥¼ ì ê²€í•˜ì„¸ìš”.
* 1~2ê°œì›” ë²”ìœ„ì—ì„œ ì†Œê·œëª¨ í…ŒìŠ¤íŠ¸ í›„ ì „ì²´ ê¸°ê°„ ì‹¤í–‰ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
* `--skip-list-top-n`ê³¼ `--dynamic-sampling`ì„ í•¨ê»˜ ì‚¬ìš©í•  ê²½ìš°, `--posts-per-page`ë¥¼ ì¡°ì •í•´ì•¼ ì‹¤ì œ ìˆ˜ì§‘ëŸ‰ì´ ì¼ì¹˜í•©ë‹ˆë‹¤.

---

## ğŸ§° FAQ / ê¸°íƒ€

**Q. ë™ì  ìƒ˜í”Œë§ê³¼ ìƒë‹¨ ìŠ¤í‚µì„ í•¨ê»˜ ì“°ê³  ì‹¶ìŠµë‹ˆë‹¤.**

> ìƒë‹¨ ìŠ¤í‚µì„ ì ìš©í•˜ë©´ í˜ì´ì§€ë‹¹ ìˆ˜ì§‘ëŸ‰ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.
> `--posts-per-page`ë¥¼ `(20 - N)`ìœ¼ë¡œ ë§ì¶”ê±°ë‚˜ í”„ë¦¬ì…‹ `sampling`ì„ ì‚¬ìš©í•˜ì„¸ìš”.

**Q. ëŒ“ê¸€ ìˆ˜ê°€ ì‹¤ì œë³´ë‹¤ +1ë¡œ í‘œì‹œë©ë‹ˆë‹¤.**

> `selectors.json`ì˜ `comments.item` ì„ íƒìë¥¼ ì‹¤ì œ ëŒ“ê¸€ ë…¸ë“œë¡œ ì¢í˜€ì£¼ì„¸ìš”.
> ì˜ˆ: `div.comment_line`, `span[id^='n']`

**Q. ëŒ“ê¸€ ì‘ì„± ì‹œê°„ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.**

> `comments.time` ì„ íƒì(ì˜ˆ: `span.minitext`)ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

**Q. íŠ¹ì • í•œ ë‹¬ë§Œ ìˆ˜ì§‘í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.**

```bash
--start 2024-01-01 --end 2024-02-01 --first-day-boundary --end-2359
```

â†’ 1ì›” í•œ ë‹¬ë§Œ ìˆ˜ì§‘ë©ë‹ˆë‹¤.